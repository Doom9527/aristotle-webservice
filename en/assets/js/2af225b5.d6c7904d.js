"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[424],{3681:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"deployment","title":"Application Deployment","description":"[//]: # (Copyright 2024 Paion Data)","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/deployment.md","sourceDirName":".","slug":"/deployment","permalink":"/aristotle-webservice/en/docs/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deployment.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Application Deployment"},"sidebar":"tutorialSidebar","previous":{"title":"Service Configuration","permalink":"/aristotle-webservice/en/docs/configuration"},"next":{"title":"Filtering by Properties","permalink":"/aristotle-webservice/en/docs/filtering"}}');var r=t(4848),i=t(8453);const s={sidebar_position:3,title:"Application Deployment"},a=void 0,c={},d=[{value:"1. Prerequisites",id:"1-prerequisites",level:3},{value:"2. Build and Package",id:"2-build-and-package",level:3},{value:"3. Deployment Methods",id:"3-deployment-methods",level:3},{value:"Method 1: Run with <code>java -jar</code>",id:"method-1-run-with-java--jar",level:4},{value:"Method 2: Deploy with Docker Compose (Recommended)",id:"method-2-deploy-with-docker-compose-recommended",level:4},{value:"4. Service Access",id:"4-service-access",level:3},{value:"5. Troubleshooting",id:"5-troubleshooting",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["This section describes how to deploy the ",(0,r.jsx)(n.a,{href:"https://aristotle-ws.com",children:"Aristotle"})," service on a server."]}),"\n",(0,r.jsx)(n.h3,{id:"1-prerequisites",children:"1. Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"Before deploying, ensure the following software is installed on your server:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Java 17"}),": To run the application."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Maven"}),": To build the project (if you build on the server)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Docker & Docker Compose"}),": For containerized deployment (recommended)."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["This guide assumes a server environment like ",(0,r.jsx)(n.code,{children:"Ubuntu 22.04+"}),". For Java and Maven installation, please refer to the ",(0,r.jsx)(n.a,{href:"/aristotle-webservice/en/docs/setup",children:"Local Development Setup"})," guide."]})}),"\n",(0,r.jsx)(n.h3,{id:"2-build-and-package",children:"2. Build and Package"}),"\n",(0,r.jsx)(n.p,{children:"First, clone the repository and run the Maven package command. You may need to provide database environment variables to run the tests, or you can skip them."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# 1. Clone the repository\ngit clone git@github.com:Doom9527/aristotle-webservice.git\ncd aristotle-webservice\n\n# 2. Set database environment variables (optional, for running tests)\nexport NEO4J_URI=YOUR_NEO4J_URI\nexport NEO4J_USERNAME=YOUR_NEO4J_USERNAME\nexport NEO4J_PASSWORD=YOUR_NEO4J_PASSWORD\nexport NEO4J_DATABASE=YOUR_NEO4J_DATABASE\n\n# 3. Package the application\n# -Dmaven.test.skip=true will skip tests and speed up the build\nmvn clean package -Dmaven.test.skip=true\n"})}),"\n",(0,r.jsxs)(n.p,{children:["After the command succeeds, you will find the ",(0,r.jsx)(n.code,{children:"Aristotle-1.0-SNAPSHOT.jar"})," file in the ",(0,r.jsx)(n.code,{children:"target/"})," directory."]}),"\n",(0,r.jsx)(n.h3,{id:"3-deployment-methods",children:"3. Deployment Methods"}),"\n",(0,r.jsx)(n.p,{children:"We provide two recommended methods for deployment."}),"\n",(0,r.jsxs)(n.h4,{id:"method-1-run-with-java--jar",children:["Method 1: Run with ",(0,r.jsx)(n.code,{children:"java -jar"})]}),"\n",(0,r.jsx)(n.p,{children:"This is the most basic way to run the service."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"java -jar target/Aristotle-1.0-SNAPSHOT.jar\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configuration Management"}),":"]}),"\n",(0,r.jsxs)(n.p,{children:["You can override the default settings in ",(0,r.jsx)(n.code,{children:"application.yaml"})," by setting environment variables before running the ",(0,r.jsx)(n.code,{children:"java"})," command."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Override database configuration and server port\nexport SPRING_DATA_NEO4J_URI=bolt://prod-neo4j:7687\nexport SPRING_DATA_NEO4J_USERNAME=prod_user\nexport SPRING_DATA_NEO4J_PASSWORD=prod_password\nexport SERVER_PORT=8080\n\njava -jar target/Aristotle-1.0-SNAPSHOT.jar\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Environment Variable Naming",type:"tip",children:(0,r.jsxs)(n.p,{children:["Note that Spring Boot recommends a specific format for environment variables. For example, ",(0,r.jsx)(n.code,{children:"spring.data.neo4j.uri"})," becomes ",(0,r.jsx)(n.code,{children:"SPRING_DATA_NEO4J_URI"}),"."]})}),"\n",(0,r.jsx)(n.h4,{id:"method-2-deploy-with-docker-compose-recommended",children:"Method 2: Deploy with Docker Compose (Recommended)"}),"\n",(0,r.jsx)(n.p,{children:"This is the recommended method for production environments, as it allows you to easily manage the application and its dependencies (like a Neo4j database) together."}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," and ",(0,r.jsx)(n.code,{children:"Dockerfile"})," in the project root are already set up for you."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# From the project root directory\n# The -d flag runs the services in the background\ndocker-compose up -d --build\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"--build"})," flag forces a rebuild of the Docker image, ensuring you are using the latest code."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configuration Management"}),":"]}),"\n",(0,r.jsxs)(n.p,{children:["You can configure the service by modifying the ",(0,r.jsx)(n.code,{children:"environment"})," section in the ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," file."]}),"\n",(0,r.jsx)(n.h3,{id:"4-service-access",children:"4. Service Access"}),"\n",(0,r.jsx)(n.p,{children:"Once the service is running:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Application Port"}),": Defaults to ",(0,r.jsx)(n.code,{children:"8080"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API Documentation"}),": Access ",(0,r.jsx)(n.code,{children:"http://<your-server-ip>:8080/doc.html"})," to view the OpenAPI (Swagger) documentation."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Health Check"}),": Access ",(0,r.jsx)(n.code,{children:"http://<your-server-ip>:8080/actuator/health"})," to check the application's health status."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"5-troubleshooting",children:"5. Troubleshooting"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:'Problem: Startup fails with "Failed to execute CommandLineRunner" or a "constraint" related error.'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"Caused by: org.neo4j.driver.exceptions.DatabaseException: Unable to create Constraint ...\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Reason"}),": On its first run, the service automatically creates unique constraints in the Neo4j database. If your database already contains data that violates these constraints (e.g., two user nodes with the same ",(0,r.jsx)(n.code,{children:"oidcid"}),"), the constraint creation will fail, and the application will stop."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": It is recommended to clear the conflicting data from your database and restart the service."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var o=t(6540);const r={},i=o.createContext(r);function s(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);